#!/bin/bash

set -e

# ANSI color codes
GREEN=$(tput setaf 2)
YELLOW=$(tput setaf 3)
RESET=$(tput sgr0)

printf "${GREEN}ðŸŒŸ Starting user setup...${RESET}\n"

read -p "${YELLOW}ðŸ”‘ Enter login: ${RESET}" login
read -p "${YELLOW}ðŸ”’ Enter password: ${RESET}" -s password
read -p "${YELLOW}ðŸ”‘ Enter path of SSH public key: ${RESET}" -e ssh_pub_path

printf "${GREEN}ðŸš€ Creating user directories and setting up SSH...${RESET}\n"

homedir="/home/$login"
ssh_dir="$homedir/.ssh"

sudo mkdir -p "$ssh_dir"
sudo cat "$ssh_pub_path" >> "$ssh_dir/authorized_keys"
sudo cp -rT /etc/skel "$homedir"
sudo useradd -d "$homedir" -s /bin/bash "$login"
sudo chown -R "$login:$login" "$homedir"
echo "$login:$password" | sudo chpasswd

printf "${GREEN}âœ… User setup completed successfully!${RESET}\n"

# Check if user is successfully added
grep "$login" /etc/passwd

printf "${GREEN}ðŸŽ‰ Enjoy your new user account!${RESET}\n"

